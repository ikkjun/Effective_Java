# Item 89. 인스턴스 수를 통제해야 한다면 readResolve 보다는 열거 타입을 사용하라
## 인스턴스 수를 통제하는 방식
### readResolve
싱글턴 패턴을 사용한 클래스는 선언에 implements Serializable을 추가하는 순간 싱글턴이 아니다. 
readResolve 기능을 이용하면 readObject가 만들어낸 인스턴스를 다른 것으로 대체할 수 있다.
클래스가 Serializable을 구현한다면 readResolve 메서드를 추가해 싱글턴이라는 속성을 유지할 수 있다.

readResolve를 인스턴스 통제 목적으로 사용한다면 객체 참조 타입 인스턴스 필드는 모두 transient로 선언해야 한다. 
그렇지 않으면 readResolve 메서드가 수행되기 전에 역직렬화된 객체의 참조를 공격할 여지가 남는다.

필드를 transient로 선언하여 문제를 고칠 수 있지만 클래스를 원소 하나짜리 열거 타입으로 바꾸는 편이 더 나은 선택이다.
readResolve 메서드를 사용해 순간적으로 만들어진 역직렬화된 인스턴스에 접근하지 못하게 하는 방법은 깨지기 쉽고 신경을 많이 써야 하는 작업이다.

### 열거 타입
직렬화 가능한 인스턴스 통제 클래스를 열거 타입을 이용해 구현하면 선언한 상수 외의 다른 객체는 존재하지 않음을 자바가 보장해준다. 
물론 공격자가 특권(privileged) 메서드를 악용한다면 임의의 네이티브 코드를 수행할 수 있는 특권을 가로챈 공격자에게는 모든 방어가 무력화된다.

## readResolve 메서드의 접근성
- final 클래스<br>
readResolve 메서드는 private이어야 한다. 
- final이 아닌 클래스
    1. private으로 선언하면 하위 클래스에서 사용할 수 없다. 
    2. package-private으로 선언하면 같은 패키지에 속한 하위 클래스에서만 사용할 수 있다. 
    3. protected나 public으로 선언하면 이를 재정의하지 않은 모든 하위 클래스에서 사용할 수 있다. 
    4. protected나 public이면서 하위 클래스에서 재정의하지 않았다면, 하위 클래스의 인스턴스를 역직렬화하면 상위 클래스의 인스턴스를 생성하여 CLassCastException을 일으킬 수 있다.